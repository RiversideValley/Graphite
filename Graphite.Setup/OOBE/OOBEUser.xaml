<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Graphite.Setup.OOBE.OOBEUser"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Graphite.Setup.OOBE"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="Transparent">

    <Grid>
        <Grid.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#7B3AED" Offset="0.0" />
                <GradientStop Color="#FF6B00" Offset="0.33" />
                <GradientStop Color="#FF3D00" Offset="0.66" />
                <GradientStop Color="#4F46E5" Offset="1.0" />
            </LinearGradientBrush>
        </Grid.Background>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Back Button, Help Icon, Image Icon, and Text -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5,5,5,0">
            <Button x:Name="HelpButton"
                 Background="Transparent"
                 BorderBrush="Transparent"
                 Margin="0,0,0,0"
                 Click="HelpButton_Click">
                <SymbolIcon Symbol="Help" Foreground="White"/>
                <ToolTipService.ToolTip>
                    <ToolTip Content="Get help with account creation"/>
                </ToolTipService.ToolTip>
            </Button>
            <TextBlock Text="Graphite - User Setup" Foreground="White" VerticalAlignment="Center"/>
        </StackPanel>


        <StackPanel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="20">
            <!-- User Creation Card -->
            <Border Width="400" Padding="20" CornerRadius="8" Background="#80000000">
                <StackPanel Spacing="16">
                    <TextBlock Text="Create Account" FontSize="24" Style="{ThemeResource TitleLargeTextBlockStyle}" HorizontalAlignment="Center" Foreground="White"/>

                    <!-- Image Preview -->
                    <PersonPicture x:Name="UserImagePreview" Width="100" Height="100" HorizontalAlignment="Center"/>

                    <!-- Live Username Update -->
                    <TextBlock x:Name="LiveUsernameUpdate" FontSize="18" FontStyle="Oblique" HorizontalAlignment="Center" Style="{ThemeResource BodyTextBlockStyle}" Foreground="White"/>
                    <TextBlock x:Name="LiveEmailUpdate" Margin="0,-15,0,0" FontSize="12" FontStyle="Oblique" HorizontalAlignment="Center" Style="{ThemeResource BodyTextBlockStyle}" Foreground="White"/>

                    <ComboBox x:Name="UserImageComboBox" 
                          Header="Select User Image" 
                          HorizontalAlignment="Stretch" 
                          SelectionChanged="UserImageComboBox_SelectionChanged">
                        <ComboBox.HeaderTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Foreground="White"/>
                            </DataTemplate>
                        </ComboBox.HeaderTemplate>
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Image Source="{Binding ImagePath}" Width="32" Height="32" Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <TextBox x:Name="UsernameTextBox" Header="Username" MaxLength="30" PlaceholderText="Enter username" TextChanged="UsernameTextBox_TextChanged">
                        <TextBox.HeaderTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Foreground="White"/>
                            </DataTemplate>
                        </TextBox.HeaderTemplate>
                    </TextBox>

                    <TextBox x:Name="EmailTextBox" Header="Email" MaxLength="40" PlaceholderText="Enter Email (Optional)" TextChanged="EmailTextBox_TextChanged">
                        <TextBox.HeaderTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Foreground="White"/>
                            </DataTemplate>
                        </TextBox.HeaderTemplate>
                    </TextBox>

                    <Grid>
                        <PasswordBox x:Name="PasswordBox" MaxLength="25" Header="Password" PlaceholderText="Enter password (Optional)">
                            <PasswordBox.HeaderTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" Foreground="White"/>
                                </DataTemplate>
                            </PasswordBox.HeaderTemplate>
                        </PasswordBox>
                        <Button x:Name="TogglePasswordVisibilityButton"
                             HorizontalAlignment="Right"
                             VerticalAlignment="Bottom"
                             Background="Transparent"
                             BorderBrush="Transparent"
                             Padding="8,4"
                             Click="TogglePasswordVisibilityButton_Click">
                            <FontIcon x:Name="PasswordVisibilityIcon" 
                                   FontFamily="Segoe MDL2 Assets" 
                                   Glyph="&#xE7B3;"
                                   Foreground="White"/>
                        </Button>
                    </Grid>

                    <Button x:Name="CreateUserButton" Content="Create Account" HorizontalAlignment="Stretch" Click="CreateUserButton_Click">
                        <Button.Resources>
                            <ResourceDictionary>
                                <Style TargetType="Button" BasedOn="{StaticResource AccentButtonStyle}">
                                    <Setter Property="CornerRadius" Value="20"/>
                                    <Setter Property="Padding" Value="24,12"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                </Style>
                            </ResourceDictionary>
                        </Button.Resources>
                    </Button>
                </StackPanel>
            </Border>

            <!-- Next Step Button (Initially Hidden) -->
            <Button x:Name="NextStepButton" HorizontalAlignment="Center" Visibility="Collapsed" Click="NextStepButton_Click">
                <Button.Resources>
                    <ResourceDictionary>
                        <Style TargetType="Button" BasedOn="{StaticResource AccentButtonStyle}">
                            <Setter Property="CornerRadius" Value="20"/>
                            <Setter Property="Padding" Value="24,12"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                        </Style>
                    </ResourceDictionary>
                </Button.Resources>
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Next Step" VerticalAlignment="Center"/>
                    <FontIcon Glyph="&#xE72A;" FontFamily="Segoe MDL2 Assets" FontSize="16" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
        </StackPanel>
    </Grid>
</Page>