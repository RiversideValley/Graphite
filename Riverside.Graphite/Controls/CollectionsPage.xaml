<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="Riverside.Graphite.Controls.CollectionsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:behaviors="using:CommunityToolkit.WinUI.Behaviors"
    xmlns:collect="using:Riverside.Graphite.Data.Core.Models"
    xmlns:core="using:Microsoft.Xaml.Interactions.Core"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:firebrowser="using:Riverside.Graphite.Controls"
    xmlns:helpers="using:Riverside.Graphite.Helpers"
    xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:local="using:Riverside.Graphite.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:media="using:Microsoft.Xaml.Interactions.Media"
    xmlns:person="using:Riverside.Graphite.Runtime.Helpers"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    mc:Ignorable="d">
    <Page.Resources>
        <helpers:TextSubStringConverter x:Key="SubstringConverter" />
        <helpers:InverseBoolToVisibilityConverter x:Key="InverseBooleanConverter" />
        <helpers:UrlToImageSourceConverter x:Key="UrlToImageSourceConverter" />
    </Page.Resources>

    <Grid
        Background="{ThemeResource LayerOnMicaBaseAltFillColorSecondary}"
        BorderBrush="{ThemeResource LayerOnMicaBaseAltFillColorSecondaryBrush}"
        BorderThickness="2">
        <Grid.RowDefinitions>
            <RowDefinition Height="150" />
            <RowDefinition Height="*" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <StackPanel
            Grid.Row="0"
            HorizontalAlignment="Center"
            Orientation="Horizontal"
            Spacing="4">
            <FontIcon
                FontFamily="{StaticResource FluentIcons}"
                FontSize="16"
                Glyph="&#xe71d;" />
            <TextBlock
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                FontFamily="Segoe Script"
                FontSize="48"
                FontStyle="Italic"
                FontWeight="ExtraBold"
                Foreground="{ThemeResource AccentAAFillColorDefaultBrush}"
                Text=" Collections " />
        </StackPanel>



        <!--<TextBlock
            Grid.Row="0"
            HorizontalAlignment="Center"
            FontSize="48"
            FontStyle="Italic"
            FontWeight="ExtraBold"
            Text="Collections" />-->
        <GridView
            Grid.Row="1"
            HorizontalAlignment="Center"
            ItemsSource="{x:Bind ViewModel.Items, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
            SelectedItem="{x:Bind ViewModel.SelectedCollection, Mode=OneWay}"
            SelectionMode="Single">
            <GridView.ItemTemplate>
                <DataTemplate x:DataType="collect:CollectionGroup">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <Button
                            x:Name="toggleZoom"
                            Click="GroupHeader_Click"
                            Tag="{Binding CollectionName.Id}">
                            <Grid>
                                <StackPanel
                                    Grid.Row="2"
                                    Margin="0,0,0,24"
                                    HorizontalAlignment="Center"
                                    Spacing="2">
                                    <PersonPicture
                                        x:Name="RootImage"
                                        Width="120"
                                        Height="120"
                                        Margin="0,24,0,0"
                                        HorizontalAlignment="Center"
                                        Background="{Binding CollectionName.BackgroundBrush}"
                                        Initials="{Binding CollectionName.Name, Converter={StaticResource SubstringConverter}, ConverterParameter='0,1'}" />
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        FontSize="18"
                                        FontWeight="SemiBold"
                                        Text="{Binding CollectionName.Name}" />
                                </StackPanel>
                            </Grid>
                        </Button>
                    </StackPanel>
                </DataTemplate>
            </GridView.ItemTemplate>
            <GridView.ItemsPanel>
                <ItemsPanelTemplate>
                    <VariableSizedWrapGrid Orientation="Horizontal" />
                </ItemsPanelTemplate>
            </GridView.ItemsPanel>
        </GridView>

        <ListView
            Grid.Row="2"
            HorizontalAlignment="Center"
            ItemsSource="{x:Bind ViewModel.SubHistoryItems, Mode=OneWay}"
            SelectionMode="Single">
            <ListView.Transitions>
                <TransitionCollection>
                    <EntranceThemeTransition FromHorizontalOffset="100" />
                </TransitionCollection>
            </ListView.Transitions>
            <ListView.Resources>
                <Style TargetType="ListViewItem">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="ListViewItem">
                                <Grid>
                                    <ContentPresenter />
                                    <VisualStateManager.VisualStateGroups>
                                        <VisualStateGroup x:Name="CommonStates">
                                            <VisualStateGroup.Transitions>
                                                <VisualTransition
                                                    GeneratedDuration="0:0:0.5"
                                                    From="Unloaded"
                                                    To="Open">
                                                    <Storyboard>
                                                        <DoubleAnimation
                                                            Storyboard.TargetProperty="Opacity"
                                                            From="0"
                                                            To="1"
                                                            Duration="0:0:0.5" />
                                                    </Storyboard>
                                                </VisualTransition>
                                            </VisualStateGroup.Transitions>
                                            <VisualState x:Name="Unloaded" />
                                            <VisualState x:Name="Open" />
                                        </VisualStateGroup>
                                    </VisualStateManager.VisualStateGroups>
                                </Grid>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </ListView.Resources>
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="collect:DbHistoryItem">
                    <Grid>
                        <Grid
                            Margin="5"
                            Background="{ThemeResource LayerOnMicaBaseAltFillColorTransparentBrush}"
                            RightTapped="Grid_RightTapped">
                            <StackPanel Orientation="Horizontal" Spacing="2">
                                <Image
                                    Width="32"
                                    Height="32"
                                    Margin="{ThemeResource SmallLeftMargin}"
                                    Source="{Binding url, Converter={StaticResource UrlToImageSourceConverter}}" />
                                <StackPanel Margin="{ThemeResource XXSmallLeftTopRightBottomMargin}" Orientation="Vertical">
                                    <TextBlock
                                        FontWeight="SemiBold"
                                        Text="{Binding title}"
                                        TextWrapping="Wrap" />
                                    <TextBlock
                                        FontWeight="ExtraBold"
                                        Foreground="{ThemeResource SystemAccentColor}"
                                        MaxLines="3"
                                        Text="{Binding url}"
                                        TextTrimming="CharacterEllipsis"
                                        TextWrapping="Wrap" />
                                    <TextBlock
                                        HorizontalAlignment="Right"
                                        Style="{ThemeResource CaptionTextBlockStyle}"
                                        Text="{Binding last_visit_time}" />
                                </StackPanel>
                            </StackPanel>

                        </Grid>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

    </Grid>

    <!--<GridView ItemsSource="{x:Bind ViewModel.GroupedItems.View, Mode=OneWay}">
        <GridView.GroupStyle>
            <GroupStyle>
                <GroupStyle.HeaderTemplate>
                    <DataTemplate x:DataType="collect:CollectionGroup">
                        <StackPanel>
                            <ToggleButton
                                Width="340"
                                HorizontalAlignment="Center"
                                Click="GroupHeader_Click"
                                Content="{Binding Key}"
                                IsChecked="False" />
                        </StackPanel>
                    </DataTemplate>
                </GroupStyle.HeaderTemplate>
                <GroupStyle.Panel>
                    <ItemsPanelTemplate>
                        <VariableSizedWrapGrid Orientation="Vertical" />
                    </ItemsPanelTemplate>
                </GroupStyle.Panel>
            </GroupStyle>
        </GridView.GroupStyle>
        <GridView.ItemTemplate>
            <DataTemplate x:DataType="collect:Collection">
                <ItemsRepeater x:Name="GroupItemsPanel" ItemsSource="{Binding Items, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="collect:HistoryItem">
                            <Grid
                                Margin="5"
                                Background="{ThemeResource LayerOnMicaBaseAltFillColorTransparentBrush}"
                                ColumnDefinitions="Auto,*"
                                RightTapped="Grid_RightTapped">
                                <Image
                                    Width="32"
                                    Height="32"
                                    Source="{Binding ImageSource}" />
                                <StackPanel Grid.Column="1" Margin="12,0,0,0">
                                    <TextBlock
                                        FontWeight="SemiBold"
                                        Text="{Binding Title}"
                                        TextWrapping="Wrap" />
                                    <TextBlock
                                        FontWeight="ExtraBold"
                                        Foreground="{ThemeResource SystemAccentColor}"
                                        MaxLines="2"
                                        Text="{Binding Url}"
                                        TextWrapping="Wrap" />
                                    <TextBlock
                                        HorizontalAlignment="Right"
                                        Style="{ThemeResource CaptionTextBlockStyle}"
                                        Text="{Binding LastVisitTime}" />
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
            </DataTemplate>
        </GridView.ItemTemplate>
    </GridView>-->
</Page>
